name: djornl_fetch_phenotypes
description: Fetch a phenotype or list of phenotypes by key, and the edges and nodes within the specified distance (number of hops) of those phenotype nodes.
params:
  type: object
  additionalProperties: false
  required: [keys]
  properties:
    keys:
      type: array
      title: Phenotype Keys
      items:
        $ref: "../../datasets/djornl/definitions.yaml#definitions/djornl_node/_key"
      minItems: 1
      examples: [["As2"],["As2", "Na23"]]
    distance:
      $ref: "../../datasets/distance.yaml"
    edge_types:
      $ref: "../../datasets/djornl/edge_types_filter.yaml"
query: |
  LET node_ids = (
    FOR n IN djornl_node
      FILTER n._key IN @keys AND n.node_type == 'pheno'
      FOR v, e, p IN 0..@distance ANY n djornl_edge
        OPTIONS {bfs: true, uniqueVertices: "global"}
        FILTER length(@edge_types) == 0 || p.edges[*].edge_type ALL IN @edge_types
        RETURN DISTINCT v._id
  )
  LET edges = (
    FOR edge IN djornl_edge
      FILTER edge._from IN node_ids AND edge._to IN node_ids
        AND (length(@edge_types) == 0 || edge.edge_type IN @edge_types)
      RETURN edge
  )
  LET nodes = (
    FOR node IN djornl_node
        FILTER node._id IN node_ids
        RETURN node
  )
  RETURN {nodes, edges}
